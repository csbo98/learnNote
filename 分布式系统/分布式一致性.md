# 分布式一致性问题

在一个分布式系统中，所有的结点如何对同一个提案或者值达成共识，这是分布式系统正常工作的核心问题。共识算法就是用来保证分布式系统一致性的方法。

在异步网络模型中，没有时钟，结点必须基于收到的消息和本地计算来做出决策。CAP定理中讨论的一致性是强一致性，在异步的网络模型中，完全不能同时保证一致性、可用性和分区容错性，每一个分布式系统只能在这三种特性中选择两种。

现实世界中不存在绝对异步的网络环境，但是在部分同步的网络环境中，仍然没有办法同时保证一致性、可用性和分区容忍性。但是通过时钟可以知道当前消息有多久没有得到回应，通过超时时间能在一定程度上解决信息丢失的问题。

最终一致性：允许多个节点的状态出现冲突，但是所有能够沟通的节点都能在有限的时间内解决冲突，从不一致的状态恢复到一致的状态。
按照目前的理解来看，强一致性保证了任何读操作都能立刻读到最新值，最终一致性应该是保证在一段时间t之后，读操作能够读到最新值。随着一致性降低，读操作读到最新值需要等待的时间就越长。

## raft算法

基础的raft实现只能保证最终一致性，给每一个值添加一个是否收到新提议的标志位，每当有read request到达follower，需要判断其访问的值是否已经收到了新的提议，但是没有真正提交，如果是，那么等到提交之后再返回给client新的结果。

